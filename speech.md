# 1

- KotlinのLanguage Updateを発表したします。
- 私は遠藤と申します。

# 2

- こちらはKotlinの公式ウェブサイトです。

# 3

- Kotlin自体についてまずご説明します。
- KotlinはJetBrainsが開発したコンパイラ言語です。
- JVMバイトコードへのコンパイル、JavaScriptへのトランスパイル、LLVM中間表現へのコンパイルができます。
- 特徴としてはNull安全、スマートキャスト、データクラス、コンパイル型などの特徴があります。
- それぞれについては詳しくご説明しません。一番最後に書籍をご紹介しますのでそちらを参照してください。

# 4

- Kotlinは関数型言語からの影響を受けています。
- ラムダ式、高階関数、末尾再帰、多値、型推論、ifなどが構文ではなくて式で値を返したり、関数が中置記法で使えるなどの特徴があります。

# 5

- Kotlin の躍進のきっかけは2017年のGoogle I/OでAndroidの開発言語として公式採用されたことです。
- 当初は限られた人しか使っていなかったようなんですけども現在ではAndroid開発のメインの開発言語として使用されています。

# 6

- LLイベントでは2016年にKotlinのセッションが行われました。
- それ以降のバージョンアップの歴史をまとめました。
- 2016年2月にバージョン1.0が正式にリリースされました。
- 特徴としてはJavaとの完全互換。Javaのライブラリーがすべて呼べるといった特徴があります。
- この時点ではJavaバージョン6のバイトコードへのコンパイルが可能でした。
- 先ほど言いましたように2017年5月にGoogle io でAndroidの開発言語として正式に採用されました。
- 2017年3月のバージョン1.1ではJavaScriptへのトランスパイルが可能になりました。
- コルーチンが実験的な機能として導入されました。
- Javaバージョン9のバイトコードへのコンパイル、コンパイル速度の向上などの改良が行われました。

# 7

- 2017年11月にバージョン1.2がリリースされましてマルチプラットフォームプロジェクトが作れるようになりました。
- 2018年11月にバージョン1.3がリリースされましてコルーチンの正式サポート、Kotlin/Native、契約(Contracts)などが追加されました。

# 8

- 2016年のバージョン1.0から現在の1.3までの大きなトピックとしてはマルチプラットフォーム対応、コルーチン、契約などがあります
- それぞれについて次に説明します。

# 9

- まずマルチプラットフォーム対応なんですが、当初は Java との完全互換が大きなメリットでした。
- 例えばJavaプロジェクトの一部をkotlinに少しづつ書き換えていくというようなことも可能でした。
- JavaScript対応が行われてフロントエンドもKotlinで書けるようになりました。
- Kotlin/Native対応が行われJavaライブラリに依存しない道が開かれました。
- Kotlinの適用分野としては当初はAndroid開発が主な用途だったんですが現在ではサーバーサイドからフロントエンドまで全てKotlinで開発できるようになっています。

# 10

- マルチプラットフォームプロジェクトですが一つのプロジェクトで複数ターゲットのビルドが可能になります。
- マルチプラットフォームプロジェクトではbuild.gradleなどにビルドターゲットごとの設定を記述します。
- ですけどもgradle initでマルチプラットフォームプロジェクトが作れるって言うようなところまでは行ってません。
- プロジェクトテンプレートがないので。一応書けるっていう状態です。

# 11

- Javaへの対応なんですけど当初はJavaバージョン6のバイトコードでラムダとか関数的なプログラミングができるようなるって言うのがメリットでした。
- Javaバージョン8が広く使われるようになって当初のメリットは薄れたのではないかっていう風に思っています。
- Kotlin自体もJavaバージョン8以降のバイトコードに対応できるようになりました。

# 12

- JavaScript対応ですがとりあえずKotlinからJavaScriptへのトランスパイルはできるようになった、というステータスです。
- TypeScriptやDartに比べて便利かと言われると考えちゃう。
- Kotlin/NativeのターゲットとしてWebAssemblyがあるので将来的にはこちらの方が有望なのかも知れません。

# 13

- Kotlin/NativeですがKotlinからLLVMの中間表現にコンパイルします。
- ターゲットとしてはLinux、Windows、Android、macOS、WebAssemblyといったようなターゲットに最終的にはコンパイルできま。
- 当然ながらJavaが直接呼べる直接わけではないのでJavaライブラリは使えません。
- 現在はKotlinで書かれたライブラリの整備が進んでいます。
- メリットとしてはiOSアプリがKotlinで書けます。iOS開発者の方はSwiftで書くんだと思いますけど。

# 14

- Kotlinのコルーチンはノンブロッキングで実行される関数です。
- 関数の途中で処理を中断したり再開したりできます
- 他の言語にもあるasyncやawit、yield、チャネルなどが使えます。
- async、awaitなどはKotlinでは関数です。
- Kotlinのasyncはコルーチンビルダー関数と呼ばれる関数の一種です。asyncの中はノンブロッキングで実行されます。
- async以外のコルーチンビルダー関数にはlaunchなどがあります。
- Kotlinのawaitはサスペンド関数と呼ばれる関数の一種です。
- yieldもサスペンド関数の一種で実行の途中で呼び出し側に値を返します。
- Goのチャネルに似たChannelも使えます。

# 15

- asyncの具体的な使い方を見てみます。
- asyncの中はノンブロッキングで実行されるのでこの例ではすぐ次のprintlnが実行されてしまいmainが終わってしまいます。

# 16

- asyncの後にThread.sleepを入れてやるとasyncの中のprintlnが実行されます。

# 17

- asyncの戻り値はDefferdです。Defferdに対してawaitが呼べますがトップレベルで呼ぶとコンパイルエラーになります。
- エラーの内容は、サスペンド関数はコルーチンの中か別のサスペンド関数の中でしか呼べないよ、というものです。

# 18

- runBlockingはコルーチンビルダー関数の一種です。
- 先ほどのasync/awaitをrunBlockingの中に置きました。
- これでawaitが実行されasyncの実行を待ちます。

# 19

- 関数そのものをノンブロッキングにもできます。
- このhello関数はString型を返すDefferd型を返す関数です。

# 20

- awaitはコルーチンの中かサスペンド関数の中でしか呼べないのでrunBlockingの中でhello関数の戻り値に対してawaitを呼んでやります。

# 21

- 契約(Contracts)はスマートキャストの判定を改善するための宣言です。

# 22

- そもそもスマートキャストとは何か。
- まずスマートじゃないキャストの例を見てみます。
- この例はJavaです。
- Animalを継承したCatとDogがあってそれぞれscratchメソッドとbarkメソッドを持っています。
- scratchとbarkを呼ぶにはinstanceofで判定して明示的にキャストしています。
- アンチパターンではありますがやってしまいがちなのではないかと思います。

# 23

- KotlinのスマートキャストではisでチェックしてCatまたはDogであることが明確なのでそれぞれのメソッドが呼べます。

# 24

- バージョン1.2以前のKotlinではこのスマートキャストが効かないケースがありました。
- それを改良したのが契約(Contracts)です。
- 詳しくは長澤太郎さんのスライドを見てください。

# たろうさんのスライド3

- スマートキャストが効かない場合がありました。

# たろうさんのスライド7

- Kotlin 1.3では契約が導入されたのでスマートキャストが効きます。

# 25

- Kotlinの書籍ですが2016年にKotlinスタートブックが出版されました。私が知る限り世界初のKotlinの書籍です。
- 表紙に赤べこが使われてますので通称赤べこ本と呼ばれています。
- 2017年に続編のKotlin Web アプリケーションっていう本が出ました。
- 内容的にはKotlin 1.0と1.1の頃なのでマルチプラットフォームなどの新しい機能については書かれていません。

# 26

- 英語の書籍では2017年にKotlin in Action、2019年にJoy of Kotlinが出版されています。
- これ以外にも英語書籍はいろいろ出版されてます。

# 27

- この発表のスライドとサンプルコードはこちらのリポジトリにあります。
- 以上KotlinのLanguage Updateでした。

